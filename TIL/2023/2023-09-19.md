
# 자바에서는 왜 instance of 사용을 지양해야 할까?
https://tecoble.techcourse.co.kr/post/2021-04-26-instanceof/

캡슐화
객체 지향에서 설명하는 캡슐화란 객체의 상태와 행위를 외부에서 사용하거나 확인하지 못하도록 숨기는 것을 말합니다. 하지만 instance of를 사용하게 되면 외부에서 해당 객체가 어떤 클래스인지, 어떤 작업을 수행하는지와 같은 정보를 알게 됩니다. 이렇게 캡슐화가 깨짐으로써 파생되는 몇 가지 문제들이 있습니다.


OCP (Open Closed Principle)
OCP는 객체의 기능 확장에는 열려있고, 변화에는 닫혀있어야 한다는 원칙입니다. 즉 객체의 기능을 추가할 때는 쉽게 수용할 수 있어야 하며, 최대한 기능을 수정할 때 다른 부분에 미치는 영향을 최소화해야 합니다. 

SRP (Single Responsibility Principle)
SRP는 하나의 객체에게 하나의 책임을 부여해야 한다는 원칙입니다. 각 객체가 책임을 하나만 수행해야 변경 지점이 명확해지고 유지보수하기도 훨씬 수월해지기 때문입니다. 


성능










---

# 달리는 기차의 바퀴 교체하기

패키지를 분리했는데 의도했던 대로 코드가 분리되지 못하는 상황일 때 어떻게 처리해서 옮겨줄 수 있을까? 의식적으로 연습해보자


### 학습 목표 
- 유지보수, 리팩터링 역량의 필요성 
- 점진적인 리팩터링 전략에 대한 이해


### 레벨3부터 지금까지 한 일

- 서비스를 기획했다.
- 그리고 빠르게 런칭했다.
- 구현하면서 프로젝트에 대한 도메인 지식이 늘어간다.
	- 관련 도메인 분야를 공부하면서 누적되는 지식 (배달, 이커머스, 메신저 등등)
	- 이상과 현실의 괴리
- 개선이 필요한 부분이 보인다.
	- 사용자 요구사항
	- 경쟁사 대응
	- 팀원들의 도메인 이해도 증가
		- 서비스를 운영하면서 도메인 지식이 증가하고 예전에 생각했던 부분이 수정되어야 할 필요성을 느끼게 됨
	- 공부하면서 알게 된 기술 적용


### 유지보수 역량이 필요하다.

- (초창기) 배달의민족은 대학생도 만들 수 있다.
	- 만드는 건 누구나 한다.
	- 서비스를 유지하고 발전시켜 나가는 게 어렵다.
		- ["주위에 공공배달앱 쓰는 사람 없는데"…수수료도 세금으로 메워준다고?](https://www.mk.co.kr/news/society/10277220)
- 기업들은 서비스 개발 마인드를 가진 개발자가 필요하다.
- 서비스를 지속적으로 발전시키기 위해 필요한 역량은?
	- 협업 => 소프트 스킬
	- 유지보수 (리팩터링)
		- [스타트업, SI개발자를 채용해도 될까?](https://greypencil.tistory.com/140)



### 왜 유지보수 역량이 필요한가? 

출처 
- [금융 플랫폼 전쟁 금융사, '슈퍼앱'으로 빅 테크 잡을까](http://news.bizwatch.co.kr/article/finance/2022/08/31/0011) 
- 카카오뱅크 시가총액
카카오뱅크가 실제로 4대 금융지주보다 수익이 적음에도 시총이 높은 이유는 앞으로 서비스를 계속 발전해나가면서 성장 가능성에 대한 기대가 반영된 것이다.

### 달리는 기차의 바퀴를 갈아끼운다.
- 처음부터 완벽하게 만들 수 없다.
	- 왜?
		- 시장 상황은 계속 바뀐다.
		- 참여자들의 역량도 변한다.
		- 기술이 발전한다.
		- 등등등
- 달리는 기차의 바퀴를 바꿀 수 있어야 한다.
	- 어떻게?
		- 점진적으로 리팩터링 하는 미션으로 연습한다.


### 미션 다시보기
- MVC 프레임워크 구현하기
- 자바 -> 자바로 점진적인 리팩터링하기



![[Pasted image 20230919104210.png]]

우리는 controller를 추가하면서 기능을 추가 구현하고 싶은데 계속 프레임워크 관련 코드도 같이 추가해야되고 수정해야 되는 문제가 발생한다.


![[Pasted image 20230919110933.png]]

Servlet Request,Response를 항상 파싱해서 사용할 것인가? controller 추가할 때마다 프레임워크 관련 코드를 수정할 것인가? 등등... 이러한 문제때문에 재설계를 꿈꾸기도 한다...


![[Pasted image 20230919111228.png]]

새로운 개발자가 뽑히는게 항상 생산성 향상으로 이어지는게 아니다. 기존 개발자가 OJT도 해줘야 하고 여러 리소스가 발생한다.

![[Pasted image 20230919111538.png]]

기존 서비스를 새로 만드는 것 때문에 정작 해결해야할 비즈니스 요구사항을 제대로 수용하지 못하게 된다는게 가장 큰 문제라고 생각한다.


점진적인 리팩터링 전략 

- 특정 기능을 새로운 애플리케이션 및 서비스로 점진적으로 교체하여 레거시 시스템을 단계적으로 마이그레이션한다. 
- 레거시 시스템의 기능이 교체되면 결 국 새 시스템이 기존 시스템의 모든 기 능을 대체하여 기존 시스템을 중단하 고 서비스 해제할 수 있다. 
- [교살자 패턴, 스트랭글러 패턴 (strangler pattern)](https://johngrib.github.io/wiki/pattern/strangler/)


![[Pasted image 20230919111956.png]]

실수는 불가피하나 이를 작은 규모에서 수행하기 때문에 학습하는데 부담도 덜하고 복구하기도 훨씬 쉬운 환경이다.



![[Pasted image 20230919112256.png]]
쿠팡 사례: 2013년 전환 시작(https://medium.com/@coupang-engineering-kr/how-coupang-built-a-microservice-architecture-fd584fff7f2b), 2015년 전환 종료(https://aubrey-dev.tistory.com/12)

계속 서비스 하면서 점진적으로 분리해야해서 이렇게 오래걸리는건가요??
토미의 답변 : 서비스를 하면서 점진적으로 분리해야해서 오래 걸리기도 해요. DB 분리 작업에도 많은 일이 있어요. 새로운 테이블 설계도 해야하고, 각 데이터를 누가 어디서 관리할지, 어떤 API로 제거할지 설계도 해야하고, 하나의 DB에서 조인으로 제공하던 데이터를 API로 제공해야 하니 성능도 확인해야 하고, 어디에서 캐시를 사용할지, 데이터 변경에 대해 전파가 필요한지와 같은 고민도 필요해요.



![[Pasted image 20230919113430.png]]

서비스를 개발하다보면 자연스럽게 이걸 분리해야겠다는 생각이 드는 순간이 온다.
https://learn.microsoft.com/ko-kr/azure/architecture/patterns/gateway-routing

깃허브 CTO 마이크로서비스 전환 후회... https://news.hada.io/topic?id=7839


![[Pasted image 20230919113741.png]]
DB를 하나로 같이 쓰면 다른 부서에서 운영하는 서비스 트레픽 등과 같은 부분들도 걱정하고 함께 고려해야 하는데 MSA로 분리하면 더 유연하고 편하게 서비스를 설계할 수 있다는 장점은 있다.

네트워크 통신 비용으로 인한 성능 이슈가 있을 수 있고, 트랜잭션 처리는 어떻게 할 것인가? 모놀리스로하면 그냥 트랜잭션 걸어주면 될텐데... 분산 트랜잭션을 굳이 써야만 하는가? 등의 고민들... 

시스템 복잡도가 올라가면서 운영비용이 올라간다.
각 마이크로 서비스에서 운영해야 하는 AWS 비용이 배로 늘어날 수 있다.

모놀리스가 무조건 나쁜 설계가 아니다.
모놀리스는 레거시와 동의어가 아니다. 모놀리스는 선택할 수 있는 한 가지의 방법일 뿐이다.

스타트업에서 MSA 한다 그러면 진짜 재고해야 한다. 과연 해당 기업의 규모에서 감당할 수 있는가? 미개발 시스템보다 기존 재개발 가능한 시스템을 분해하는게 쉽다는 것을 기억하자.



### 기술 변경에 따른 고려사항 
- No Silver Bullet 
- 변경하려는 기술이 공존하는 환경을 만드는데 비용이 얼마나 드는가? 
- 새롭게 개발하는데 투자하는 비용과 기간은 얼마인가? 
- 점진적으로 리팩토링하는데 비용이 얼마나 드는가?


항상 점진적인 리팩토링이 또 옳은 것만은 아니다. 완전히 새로 구현하는 것과 실질적인 비용을 따져보고 선택하는 것이 필요하다.



---

리눅스 스레드 헬스 체크
[https://unixhealthcheck.com/blog?id=465](https://unixhealthcheck.com/blog?id=465)


자바에서 perf 명령을 통해 스레드 상태 체크하는 레퍼런스
[https://bell-sw.com/announcements/2022/04/07/how-to-use-perf-to-monitor-java-performance/](https://bell-sw.com/announcements/2022/04/07/how-to-use-perf-to-monitor-java-performance/)


버퍼풀은 어디에서 동작하는 개념이지?



