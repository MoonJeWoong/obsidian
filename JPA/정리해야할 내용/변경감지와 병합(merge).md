
준영속 엔티티를 다시 영속화하면서 변경사항을 저장해야 하는 경우 방법은 다음과 같이 2가지이다.

- merge()를 사용한다.
- find를 통해 엔티티를 조회해와서 변경감지를 이용한다.

### merge를 이용한 방식

1. merge 방식을 사용하면, 일단 영속성 컨텍스트(entityManage)에 동일한 id의 엔티티가 존재하는지 확인한다.
2. 만약 영속성 컨텍스트에 존재하지 않는다면, 준영속 엔티티의 id로 엔티티를 조회해온다.
3. 그 다음 조회해온 엔티티의 모든 상태를 준영속 엔티티의 상태로 덮어 씌운다.
4. 트랜잭션이 커밋될 때 변경 감지가 발생해서 update 쿼리가 실행된다.

이 때 반드시 생각해야 할 부분은 기존 엔티티의 상태 값들을 준영속 엔티티의 상태 값으로 모두 덮어 씌워버리기 때문에 null 값이 준영속 엔티티에 존재할 경우 문제가 될 수 있다는 것이다.

### 변경 감지를 이용한 방식

1. 영속성 컨텍스트에 id로 엔티티를 조회해온다.
2. 엔티티의 상태 값을 변경한다.
3. 트랜잭션 커밋 시 변경 감지가 발생해 update 쿼리가 실행된다.

merge를 사용하는 경우와 다르게 원하는 상태 값만 수정할 수 있다는 장점이 있으므로 특별한 이유가 있지 않다면 변경 감지를 사용하는 것이 바람직하다.