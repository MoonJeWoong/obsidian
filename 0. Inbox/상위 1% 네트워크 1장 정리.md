
## 1장 소목차 정리

- URL을 입력하면 HTTP 리퀘스트 메세지를 작성한다.
- URL에 매핑된 요청 웹서버 IP를 조회하는 요청을 DNS에 보낸다.
- 전 세계의 DNS가 연대하여 웹 서버의 IP를 찾아낸다.
- <mark style="background: #BBFABBA6;">프로토콜 스택</mark>에 HTTP 리퀘스트 메세지 송신을 의뢰한다.


## HTTP 리퀘스트 메시지를 작성한다.

### 탐험 여행은 URL 입력부터 시작한다.

- 브라우저는 http, ftp. email등 여러 자원에 access할 수 있는 복합적인 클라이언트이다. 
- 따라서 사용자는 브라우저가 어떠한 프로토콜을 사용하여 사용자 요청을 처리해야 할지 지정해줘야 하는데 이러한 이유로 웹서버 액세스라면 http:, ftp 서버 액세스라면 ftp: 이런 방식으로 URL을 작성해줘야 한다.
- URL은 여러가지 형식으로 입력될 수 있으나 공통적인 부분은 맨 앞부분에서 어떤 방식으로 액세스를 하는지 명시한다는 것이다. 여기 명시된 것이 액세스할 때 사용할 프로토콜에 해당한다.
	- 액세스 대상이 웹서버라면 HTTP, ftp 서버라면 FTP 프로토콜을 사용한다.
	- http:, ftp:, file:, mailto: 등의 종류가 있다.

### 브라우저는 먼저 URL을 해독한다

- 브라우저는 HTTP 리퀘스트 메세지를 작성하기 위해서 가장 먼저 입력받은 URL을 해독한다.
- URL의 형식은 다음과 같다. 
```
http://www.cyber.com/dir1/file1.html
```
- 프로토콜 + // + 서버 도메인 명 + / + 접근할 리소스 경로


### 파일명을 생략한 경우

- http://www.cypber.com/
	- 루트 디렉토리 하위의 index.html, default.html 등을 조회
- http://www.cypber.com/dir1/
	-  dir1 디렉토리 하위의 index.html, default.html 등을 조회
- http://www.cypber.com
	- / 구분자가 마지막에 생략되어 있으면 루트 디렉토리 내 기본 파일을 접근하도록 설정하는 것이 관례
	- http://www.cypber.com/index.html, http://www.cypber.com/default.html 
- http://www.cypber.com/whatisthis
	- 통례적으로 위와 같은 경우 / 경로 하위의 whatisthis라는 파일 혹은 디렉토리를 가리킨다고 판단한다.


### HTTP의 기본 개념

- HTTP 프로토콜은 서버와 클라이언트가 주고 받을 메세지의 순서와 형식을 정의한 규칙
- 리퀘스트 메세지는 URI와 HTTP Method를 포함한다. 
	- URI에는 보통 페이저 정보를 담고 있는 파일 이름이나 CGI 프로그램의 파일명을 작성한다.
	- URI에 명시된 자원을 대상으로 어떤 작업을 수행하고 싶은 것인지 명시하는 게 HTTP Method이다. 
- 리퀘스트 메세지가 서버에 도착하면 웹 서버는 메세지를 해독하고 내용대로 요청을 처리한 뒤 그 결과를 응답 메세지에 담아 전송한다. 이 때 처리 결과를 나타내는 스테이터스 코드를 함께 첨부한다.
	- GET, POST, DELETE, PUT, HEAD, OPTIONS, TRACE, CONNECT 등이 존재
	- PUT : URI에 명시된 서버의 파일을 치환한다. 만약 파일이 없으면 새로운 파일을 생성한다. 
	- HEAD : GET과 비슷하나 , 응답 메세지의 헤더에 해당하는 내용만 전송하고 body 데이터는 전송하지 않는다. 파일의 최종 갱신일자 확인과 같은 경우에 사용한다.
	- OPTIONS : 통신 옵션을 통지하거나 조사할 때 사용한다.
	- TRACE : 서버측에서 받은 리퀘스트 Line과 헤더를 그대로 반환한다. 여러 프록시 서버를 거치며 요청 메세지의 헤더가 어떻게 변화하는지 확인하기 위해 사용한다.
	- CONNECT : 암호화한 메세지를 프록시로 전송할 때 이용하는 메서드이다.
	- HTTP 1.0에서는 GET, POST, HEAD만 정식으로 사용한다고 정의되어 있으며 PUT, DELETE는 부록에 부가기능으로 기술되어 있다.
	- HTTP1.1에서는 전부 사용이다.

### HTTP 리퀘스트 메세지를 만든다.

- 리퀘스트 메세지 형식

```
GET /api/study/1 HTTP/1.1  => 리퀘스트 라인(HTTP메서드 URI HTTP버전)
Accept: */*
Connection: Keep-Alive
...
(공백)
...
메세지 바디
...
```


### 리퀘스트 메세지를 보내면 응답이 되돌아온다

- 리스폰스 메세지 형식

```
HTTP/1.1 200 OK  => 스테이터스 라인 (HTTP버전 응답코드 응답메세지)
DATE : ...
...
(공백)
...
메세지 바디
...
```


- 리스폰스 응답 코드

| 코드값 | 설명                                    |
|:------ |:--------------------------------------- |
| 1xx    | 요청 처리의 경과 상황 등을 전달         |
| 2xx    | 요청 정상 처리 후 종료                  |
| 3xx    | 추가적인 요청과 같은 다른 조치가 필요함 |
| 4xx    | 클라이언트 측 오류                      |
| 5xx    | 서버 측 오류                            |


만약 응답으로 받은 html 파일 등에 이미지나 영상 등이 포함될 수 있는데 이러한 정보는 태그로 표시되어 있다. 맨 처음 html 파일 등을 응답받고 추가적인 태그를 확인했다면 해당 태그에 명시된 이미지나 영상을 추가로 요청하는 리퀘스트 메세지를 보낸다. 

ex) 이미지 태그가 3개인 html 파일을 요청하는 경우 총 요청과 응답은 몇 번 이뤄질까?
=> html 1번 각 이미지 1번씩 도합 3번 총합 4번의 요청과 응답이 발생하게 된다.



---


## 웹 서버의 IP주소를 DNS 서버에 조회한다

### IP 주소의 기본

웹 서버는 웹 요청 메세지를 만들기만 할 뿐 이를 직접 전송하는 기능은 수행하지 않기 때문에 실제로 웹 요청 메세지를 전송하는 것은 OS에서 담당한다.

서브넷
라우터
허브

네트워크 번호 + 호스트 번호 = IP 주소
IPv4 => 32bit 디지털 데이터, 8비트식 구분해서 10진수로 표현하기도 함

넷마스크
IP에서 어떤 부분이 네트워크 번호고 호스트 번호인지를 나타내기 위해 넷마스크를 IP에 덧붙여서 사용한다. 넷마스크는 왼쪽부터 1, 오른쪽에서부터 0이 나열된 형식으로 작성된다.


넷마스크와 함께 표기한 IP 예시
- 10.11.12.13 : IP 주소 본체의 표기 방법
- 10.11.12.13/255.255.255.0 : IP주소와 같은 방법으로 네트워크를 표기 (넷마스크 추가)
- 10.11.12.13/24 : 네트워크 번호를 표시하는데 사용하는 넷마스크의 1에 해당하는 비트 수로 넷마스크를 표기
- 10.11.12.0/24 : 서브넷 자체를 나타내는 주소
- 10.11.12.255/24 : 서브넷의 브로드캐스트를 나타내는 주소


### 도메인명과 IP 주소를 구분하여 사용하는 이유

OS에서 웹 서버와 통신할 때 도메인 네임이 아닌 IP를 사용하는 이유 => 효율성
IP 주소와 도메인 네임을 매핑하는 것이 DNS이다. (Domain Name System)


### Socket라이브러리가 IP 주소를 찾는 기능을 제공한다.

Socket 라이브러리 => 애플리케이션에서 OS에 포함되어 있는 네트워크 기능을 호출하기 위한 라이브러리이다.
Socket 라이브러리에는 리졸버(DNS 리졸버)가 존재하는데 이를 통해 Name Resolution을 수행한다.

### 리졸버를 이용하여 DNS 서버를 조회한다.

- 간단하게 코드 한 줄로 도메인 네임을 인자로 받아서 DNS 서버와 통신하고 응답으로 IP 주소를 받아올 수 있는 기능을 Socket 라이브러리에서 제공한다.


### 리졸버 내부의 작동

네트워크 애플리케이션(브라우저) -> 리졸버 호출
리졸버 또한 DNS 서버에 요청을 보내는 기능은 없기에 이를 수행하기 위해 프로토콜 스택을 호출하여 요청 메세지 송신을 의뢰한다.

프로토콜 스택 : <mark style="background: #BBFABBA6;">OS 내부에 내장된 네트워크 제어용 소프트웨어</mark>. 프로토콜 드라이버, TCP/IP 소프트웨어 등으로도 불린다.


- DNS 서버에 요청할 때 필요한 DNS 서버 IP 주소는 어떻게 얻어올까?
	- TCP/IP 설정 항목의 하나하나로 컴퓨터에 미리 설정되어 있어 이를 사용하게 된다.


---

## 전세계의 DNS 서버가 연대한다

### DNS 서버의 기본 동작


리졸버에서 DNS 서버에 전송하는 요청 메세지에는 다음과 같은 데이터들이 담긴다.
- 이름
- 클래스
- 타입

위 데이터들을 이용해 DNS 서버의 리소스 레코드를 조회하여 타입에 따른 응답을 내려주게 된다.


### 도메인의 계층

DNS에서는 도메인 이름을 계층적으로 작성하여 관리한다.
www.cyber.co.kr => 오른쪽에서부터 상위 계층 도메인에 해당한다.
DNS 서버는 도메인 별로 모아서 한 대씩 할당된다.


### 담당 DNS 서버를 찾아 IP 주소를 찾아온다

com, kr 등... => 최상위 도메인
최상위 도메인들의 상위 도메인 => 루트 도메인
루트 도메인에 할당된 DNS 서버는 모든 DNS 서버에 저장되어 있다. 

웹브라우저에서 시작된 DNS 서버로의 요청은 루트 DNS 서버부터 시작해 최하위 DNS 서버에 이르기까지 연쇄적으로 요청과 응답이 이뤄진다.


### DNS 서버는 캐시 기능으로 빠르게 회답할 수 있다

현실의 DNS 서버는 이상적으로 도메인 네임 당 한대씩 할당되어 있는 것은 아니다. 오히려 한 대의 DNS 서버에 여러 도메인 정보를 입력할 수 있다.

DNS 서버는 한 번 조사한 이름을 캐시에 기록할 수 있기 때문에 이를 이용해 훨씬 더 빠르고 편리하게 응답을 제공할 수 있다. 

캐시는 정보가 등재된 이후 실제 등록 정보가 변경되는 경우도 있어서 이를 주의해야 한다. 따라서 DNS 서버에 등록하는 정보에는 유효 기한을 설정하고 캐시에 저장한 데이터의 유효 기간이 지나면 캐시에서 삭제처리한다.

또한 조회에 응답할 때 해당 응답 정보가 캐시에 저장된 것인지, 아니면 실제 등록처 DNS에서 회답한 것인지 알려준다.






