
WAS에서 클라이언트로부터 요청을 받아 처리하는 과정에서 DB에 접근해야 하는 작업이 발생한다. 그러면 WAS는 DB 서버에 접근해야 하는데 이 때 WAS 서버와 DB 서버는 물리적으로 분리되어 설계되는 것이 일반적이므로 통신 과정에서 네트워크 연결이 반드시 필요하다. 

네트워크 연결에도 여러가지 방식이 존재하는데, 보통 신뢰성이 가장 높은 방식인 TCP를 사용한다. 그런데 TCP 방식으로 네트워크 통신을 하기 위해서는 클라이언트와 서버 사이에 커넥션을 맺어야한다. 이 커넥션을 맺고 끊는 과정이 상대적으로 무거운 작업이기 때문에 요청이 발생할 때마다 커넥션을 맺게 되면 병목이 발생하게 된다.

이를 방지하고자 WAS에서는 DB Connection Pool 을 둬서 미리 정해진 개수만큼의 커넥션을 만들어두고 DB 서버 접근 요청이 발생하면 이 커넥션을 할당해서 수행하도록 한다. 이후 작업이 종료되면 커넥션은 다시 커넥션 풀로 반환되어 다른 요청이 발생했을 때 사용될 수 있다.

개발 과정에서 DB Connection Pool과 DB 서버 각각마다 커넥션 관련된 설정들이 존재해서 이를 적절하게 잘 설정해주는 것이 중요하다.

DBCP 관련 설정 (Hikari CP)

MySQL 서버 커넥션 관련 설정


커넥션 풀 설정값 튜닝 => 부하테스트를 진행하면서 여러가지 병목지점들을 함께 고려해야한다.

부하테스트
- Response Per Second : 초당 처리하는 응답 수
- Average Response Time : 서버에서 응답이 돌아오는데까지 걸리는 평균 시간

부하테스트 진행 과정에서 함께 고려해야 될 사항들

WAS의 스레드 풀의 사용 현황
WAS 서버의 CPU, MEM 사용량
DB 서버의 CPU, MEM 사용량

WAS 서버를 다중화함에 따라서 DB Connection Pool의 size를 정할 때 DB 서버가 처리할 수 있는 Connection의 개수를 각각 나눠 갖도록 설계되는 경우도 있다.


---

https://www.youtube.com/watch?v=zowzVqx3MQ4&t=1163s